{
    "name": "eXpress402 Development",

    "build": {
      "dockerfile": "Dockerfile"
    },

    "workspaceMount": "source=${localWorkspaceFolder},target=/workspaces/${localWorkspaceFolderBasename},type=bind,consistency=cached",
    "workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}",

    "features": {
      "ghcr.io/devcontainers/features/common-utils:2": {
        "installZsh": true,
        "installOhMyZsh": true,
        "configureZshAsDefaultShell": true,
        "upgradePackages": true
      },
      "ghcr.io/devcontainers/features/docker-in-docker:2": {
        "version": "latest",
        "moby": true,
        "dockerDashComposeVersion": "v2"
      },
      "ghcr.io/devcontainers/features/node:1": {
        "version": "lts",
        "nodeGypDependencies": true,
        "installYarnUsingApt": true
      },
      "ghcr.io/devcontainers/features/go:1": {
        "version": "latest"
      },
      "ghcr.io/devcontainers/features/github-cli:1": {
        "version": "latest"
      }
    },

    // VS Code customizations
    "customizations": {
      "vscode": {
        "settings": {
          // General
          "terminal.integrated.defaultProfile.linux": "zsh",
          "editor.formatOnSave": true,
          "editor.rulers": [80, 120],
          "files.trimTrailingWhitespace": true,
          "files.insertFinalNewline": true,

          // JavaScript/TypeScript
          "[javascript]": {
            "editor.defaultFormatter": "esbenp.prettier-vscode",
            "editor.formatOnSave": true
          },
          "[typescript]": {
            "editor.defaultFormatter": "esbenp.prettier-vscode",
            "editor.formatOnSave": true
          },
          "[typescriptreact]": {
            "editor.defaultFormatter": "esbenp.prettier-vscode",
            "editor.formatOnSave": true
          },

          // JSON
          "[json]": {
            "editor.defaultFormatter": "esbenp.prettier-vscode",
            "editor.formatOnSave": true
          },
          "[jsonc]": {
            "editor.defaultFormatter": "esbenp.prettier-vscode",
            "editor.formatOnSave": true
          },

          // Solidity
          "[solidity]": {
            "editor.defaultFormatter": "NomicFoundation.hardhat-solidity",
            "editor.formatOnSave": true
          },
          "solidity.compileUsingRemoteVersion": "latest",
          "solidity.formatter": "forge",

          // Shell scripts
          "[shellscript]": {
            "editor.defaultFormatter": "foxundermoon.shell-format",
            "files.eol": "\n"
          }
        },

        "extensions": [
          // Solidity & Smart Contract Development
          "NomicFoundation.hardhat-solidity",

          // Docker
          "ms-azuretools.vscode-docker",

          // JavaScript/TypeScript
          "esbenp.prettier-vscode",
          "dbaeumer.vscode-eslint",

          // Git
          "eamodio.gitlens",
          "github.vscode-pull-request-github",
          "Github.copilot",
          "Github.copilot-chat",

          // Shell
          "foxundermoon.shell-format",
          "timonwong.shellcheck",

          // Markdown
          "yzhang.markdown-all-in-one",
          "davidanson.vscode-markdownlint",

          // Utilities
          "editorconfig.editorconfig",
          "christian-kohler.path-intellisense",
          "visualstudioexptteam.vscodeintellicode",
          "gruntfuggly.todo-tree"
        ]
      }
    },

    "remoteEnv": {
      "PATH": "${containerEnv:PATH}:/home/vscode/.foundry/bin:/home/vscode/go/bin:/home/vscode/.local/bin",
      "EDITOR": "code --wait",
      "GITHUB_PERSONAL_ACCESS_TOKEN": "${localEnv:CURSOR_GITHUB_TOKEN}",
      "TAVILY_API_KEY": "${localEnv:TAVILY_API_KEY}",
      "ALCHEMY_API_KEY": "${localEnv:ALCHEMY_API_KEY}",
      "ETHERSCAN_API_KEY": "${localEnv:ETHERSCAN_API_KEY}",
      "ETHERSCAN_BEARER_TOKEN": "${localEnv:ETHERSCAN_BEARER_TOKEN}",
      "TENDERLY_ACCOUNT_SLUG": "${localEnv:TENDERLY_ACCOUNT_SLUG}",
      "TENDERLY_PROJECT_ID": "${localEnv:TENDERLY_PROJECT_ID}",
      "TENDERLY_ACCESS_TOKEN": "${localEnv:TENDERLY_ACCESS_TOKEN}",
      "ENS_PROVIDER_URL": "${localEnv:ENS_PROVIDER_URL}"
    },

    "postCreateCommand": "bash -lc \"echo '[postCreate] installing hackmoney tool deps' && npm install --no-package-lock --prefix .devcontainer/hackmoney-tools\"",

    "mounts": [
      {
        "source": "eXpress402-dev-home-data",
        "target": "/home/vscode",
        "type": "volume"
      },
      {
        "source": "eXpress402-dev-docker-data",
        "target": "/var/lib/docker",
        "type": "volume"
      }
    ],

    // Run arguments
    "runArgs": [
      "--privileged",
      "--hostname=eXpress402-dev",
      "--name=eXpress402-dev",
      "--init"
    ],

    "remoteUser": "vscode",

    // Forward ports (for Next.js dev server and backend)
    "forwardPorts": [3000, 3001, 8545],

    // Port attributes
    "portsAttributes": {
      "3000": {
        "label": "Next.js Frontend",
        "onAutoForward": "notify"
      },
      "3001": {
        "label": "Backend Server",
        "onAutoForward": "notify"
      },
      "8545": {
        "label": "Local Blockchain",
        "onAutoForward": "silent"
      }
    }
  }
